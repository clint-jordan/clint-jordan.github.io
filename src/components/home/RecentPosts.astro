---
import { getCollection } from "astro:content";
import PostSnippet from "../PostSnippet.astro";
import Anchor from "../common/Anchor.astro";
import { siteConfig } from "../../site.config";

const baseUrl = import.meta.env.BASE_URL;

// Get all blog posts and sort by published date (most recent first)
const allPosts = await getCollection("blog");
const recentPosts = allPosts
  .map((post) => ({
    ...post.data,
    url: `${baseUrl}/blog/${post.data.slug}`,
  }))
  .sort((a, b) => {
    // Sort by published date, fallback to updated date, then by title
    const dateA = a.published || a.updated || new Date(0);
    const dateB = b.published || b.updated || new Date(0);
    return dateB.getTime() - dateA.getTime();
  })
  .slice(0, 5); // Get only the 5 most recent posts
---

<div class="space-y-0 mb-20">
  <div class="flex justify-between items-center pb-5">
    <h2 class="text-3xl sm:text-4xl font-display theme-text">Recent Posts</h2>
    <Anchor url=`${baseUrl}/blog` class="theme-accent hover:theme-text transition-colors">
      View all posts â†’
    </Anchor>
  </div>
  
  {recentPosts.length > 0 ? (
    <div class="space-y-6">
      {recentPosts.map((post) => (
        <PostSnippet
          title={post.title}
          description={post.description}
          url={post.url}
          tags={post.tags}
          published={post.published}
          updated={post.updated}
        />
      ))}
    </div>
  ) : (
    <p class="theme-muted">No blog posts yet.</p>
  )}
</div>
